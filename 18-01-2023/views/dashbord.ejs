<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
    <script src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script>
    <style>
        table,
        th,
        td {
            border: 1px solid black;
            border-collapse: collapse;
        }

        .center {
            margin-left: auto;
            margin-right: auto;
        }

        th,
        td {
            padding: 5px;
            text-align: left;
            width: 18%;
        }
    </style>
</head>

<body>
    <div id="chartContainer490" style="height: 370px; width: 100%;"></div>
    <div id="chartContainer90" style="height: 370px; width: 100%;"></div>
    <div id="chartContainer75-90" style="height: 370px; width: 100%;"></div>
    <div id="chartContainerCard" style="height: 370px; width: 100%; text-align: center;"></div>
</body>
<script>
    $(document).ready(() => {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const id = urlParams.get('id');
        $.ajax({
            type: "GET",
            url: "/getStudentWithMarks",
            dataType: "json",
            success: function (result) {
                if (result.data.length > 0) {
                    var options = {
                        title: {
                            text: "Marks greeter than 490"
                        },
                        animationEnabled: true,
                        data: [{
                            type: "pie",
                            startAngle: 40,
                            toolTipContent: "<b>{label}</b>: {y}%",
                            showInLegend: "true",
                            legendText: "{label}",
                            indexLabelFontSize: 16,
                            indexLabel: "{label} - {y}%",
                            dataPoints: [
                                { y: result.totalStudentLt490, label: "Lessthan490Marks" },
                                { y: result.count, label: "Greterthan490Marks" },
                            ]
                        }]
                    };
                    $("#chartContainer490").CanvasJSChart(options);
                } else {
                    document.getElementById("error").innerHTML = '<p>' + result.message + '<p>';
                }
            },
        })
        $.ajax({
            type: "GET",
            url: "/getStudentMarksIndividual",
            dataType: "json",
            success: function (result) {
                console.log(result);
                var options = {
                    title: {
                        text: "90 marks in individual subject"
                    },
                    animationEnabled: true,
                    data: [{
                        type: "pie",
                        startAngle: 40,
                        toolTipContent: "<b>{label}</b>: {y}%",
                        showInLegend: "true",
                        legendText: "{label}",
                        indexLabelFontSize: 16,
                        indexLabel: "{label} - {y}%",
                        dataPoints: [
                            { y: result.totalStudentNE90, label: "Not90MarksInIndividual" },
                            { y: result.count, label: "90MarksInIndividual" },
                        ]
                    }]
                };
                $("#chartContainer90").CanvasJSChart(options);
            },
        })
        $.ajax({
            type: "GET",
            url: "/getStudentBtw75-90",
            dataType: "json",
            success: function (result) {
                console.log(result);
                var options = {
                    title: {
                        text: "Marks between 75 to 90 in a single subject"
                    },
                    animationEnabled: true,
                    data: [{
                        type: "pie",
                        startAngle: 40,
                        toolTipContent: "<b>{label}</b>: {y}%",
                        showInLegend: "true",
                        legendText: "{label}",
                        indexLabelFontSize: 16,
                        indexLabel: "{label} - {y}%",
                        dataPoints: [
                            { y: result.totalStudentNotBtw75to90, label: "MarksNotBtw75-90" },
                            { y: result.studentBtw75to90, label: "MarksBtw75-90" },
                        ]
                    }]
                };
                $("#chartContainer75-90").CanvasJSChart(options);
            },
        })
        $.ajax({
            type: "POST",
            url: "/getStudentCard",
            dataType: "json",
            data: { "studentId": id },
            success: function (result) {
                var text = `<h1>Assign a Grade Card</h1><p><strong>Grad:</strong> ${result.Grad}</p>
                <table  class="center" style="width:20%"><tr>
                <th scope="col">Subject</th>
                <th scope="col">Marks</th>
                </tr></table>`
                for (var i = 0; i < result.subject.length; i++) {
                    text += '<table  class="center" style="width:20%">' +
                        "<tr>" + "<td>" + result.subject[i].subject + "</td>" + "<td>" + result.subject[i].marks + "</td>" + "</tr>" + "</table>";
                }
                $("#chartContainerCard").append(text);
            },
        })
    })
</script>

</html>